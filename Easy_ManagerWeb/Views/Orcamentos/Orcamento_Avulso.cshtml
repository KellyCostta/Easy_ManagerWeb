@model Easy_ManagerWeb.Models.Orcamento

<h2>Orçamento sem Compromisso</h2>

@if (TempData["Mensagem"] != null)
{
    <div class="alert alert-success">@TempData["Mensagem"]</div>
}

<form asp-action="SalvarOrcamentoAvulso" method="post" id="formOrcamentoAvulso">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a asp-action="ListarOrcamentos" class="btn btn-outline-primary">Listar Orçamentos</a>
        </div>

    <div class="mb-3">
        <label class="form-label">Nome do Cliente</label>
        <input type="text" class="form-control" name="NomeCliente" placeholder="Digite o nome do cliente" required />
    </div>

    <div class="mb-3">
        <label class="form-label">Telefone</label>
        <input type="text" class="form-control" name="TelefoneCliente" placeholder="(xx) xxxxx-xxxx" />
    </div>

    <div class="mb-3">
        <label class="form-label">Endereço</label>
        <input type="text" class="form-control" name="EnderecoCliente" placeholder="Rua, número, bairro..." />
    </div>

    <hr />

    <div class="mb-3">
        <label class="form-label">Tamanho</label>
        <select class="form-select" name="Tamanho" id="tamanho" required>
            <option value="">-- Selecione o tamanho --</option>
            <option value="Pequeno">Pequeno</option>
            <option value="Médio">Médio</option>
            <option value="Grande">Grande</option>
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Peso (Kg)</label>
        <input type="number" class="form-control" name="Peso" id="peso" step="1" placeholder="Ex: 500 (gramas)" />
    </div>

    <hr />

    <div class="mb-3">
        <label class="form-label">Distância (km)</label>
        <input type="number" step="0.01" class="form-control" name="Distancia" id="distancia" required />
    </div>

    <div class="mb-3">
        <label class="form-label">Tempo Estimado</label>
        <input class="form-control" name="Tempo" id="tempo" placeholder="Ex: 30 min" />
    </div>

    <input type="hidden" name="ValorOrcamento" id="valorOrcamento" />

    <button type="button" id="btnCalcular" class="btn btn-secondary me-2">Calcular Orçamento</button>
    <button type="submit" class="btn btn-primary">Salvar Orçamento</button>
</form>

<hr />

<div id="resultadoOrcamento" class="mt-4" style="display:none;">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">Resumo do Orçamento</h4>
            <p><strong>Cliente:</strong> <span id="resCliente"></span></p>
            <p><strong>Telefone:</strong> <span id="resTelefone"></span></p>
            <p><strong>Endereço:</strong> <span id="resEndereco"></span></p>
            <hr />
            <p><strong>Pacote:</strong> <span id="resDescricao"></span></p>
            <p><strong>Tamanho:</strong> <span id="resTamanho"></span></p>
            <p><strong>Peso:</strong> <span id="resPeso"></span> Kg</p>
            <hr />
            <p><strong>Distância:</strong> <span id="resDistancia"></span> km</p>
            <p><strong>Tempo Estimado:</strong> <span id="resTempo"></span></p>
            <h5 class="mt-3 text-success"><strong>Valor do Orçamento:</strong> R$ <span id="resValor"></span></h5>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Função de cálculo do orçamento
               function calcularOrcamento(distancia, tamanho, peso, tempo) {

            let valorBasePeso = 5.0;
            let valorBaseKm = 5.0;

            let valorPeso = 0;
            let valorTempo = 0;
            let valorTamanho = 0;
            let valorDistancia = 0;

            // --- PESO ---
            if (peso <= 1) {
                valorPeso = valorBasePeso;
            } else {
                valorPeso = valorBasePeso + ((peso - 1) * 1);
            }

            // --- TAMANHO ---
            switch (tamanho) {
                case "Pequeno": valorTamanho = 1; break;
                case "Médio": valorTamanho = 3; break;
                case "Grande": valorTamanho = 5; break;
            }

            // --- DISTÂNCIA ---
            if (distancia <= 5) {
                valorDistancia = valorBaseKm;
            } else {
                valorDistancia = valorBaseKm + ((distancia - 5) * 1);
            }

            // --- TEMPO ---
            if (tempo <= 10) {
                valorTempo = 1.0;
            } else {
                valorTempo = 1 + ((tempo - 10) * 0.20);
            }

            // --- SOMA FINAL ---
            let total = valorPeso + valorTamanho + valorDistancia + valorTempo;

            return total.toFixed(2);
        }
                $('#btnCalcular').on('click', function () {

            const nome = $('input[name="NomeCliente"]').val();
            const telefone = $('input[name="TelefoneCliente"]').val();
            const endereco = $('input[name="EnderecoCliente"]').val();


            const tamanho = $('#tamanho').val();
            const peso = parseFloat($('#peso').val()) || 0;
            const distancia = parseFloat($('#distancia').val()) || 0;
            const tempo = parseFloat($('#tempo').val()) || 0;

            if (!distancia || !tamanho) {
                alert('Preencha a distância e o tamanho para calcular.');
                return;
            }

            const total = calcularOrcamento(distancia, tamanho, peso, tempo);

            $('#valorOrcamento').val(total);

            $('#resCliente').text(nome);
            $('#resTelefone').text(telefone);
            $('#resEndereco').text(endereco);

            $('#resTamanho').text(tamanho);
            $('#resPeso').text(peso);
            $('#resDistancia').text(distancia);
            $('#resTempo').text(tempo);
            $('#resValor').text(total);

            $('#resultadoOrcamento').fadeIn();
        });


    </script>
}

@model IEnumerable<Easy_ManagerWeb.Models.Entrega>

@{
    ViewData["Title"] = "Relatórios de Vendas";
    // Calcula total de vendas de forma segura
    decimal totalVendas = Model?.Sum(e => e.Orcamento.HasValue ? (decimal)e.Orcamento.Value : 0) ?? 0;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Relatórios de Vendas</h2>

    <div>
        <a asp-action="Relatorio" asp-route-periodo="diario" class="btn btn-outline-primary">Diário</a>
        <a asp-action="Relatorio" asp-route-periodo="semanal" class="btn btn-outline-primary">Semanal</a>
        <a asp-action="Relatorio" asp-route-periodo="mensal" class="btn btn-outline-primary">Mensal</a>
        <a asp-action="Relatorio" asp-route-periodo="anual" class="btn btn-outline-primary">Anual</a>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-body">
        @if (Model == null || !Model.Any())
        {
            <div class="alert alert-info text-center">
                Nenhuma entrega encontrada neste período.
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="bg-light">
                        <tr>
                            <th>ID</th>
                            <th>Cliente</th>
                            <th>Data de Entrega</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var entrega in Model)
                        {
                            <tr>
                                <td>@entrega.Id</td>
                                <td>@(entrega.Cliente?.Nome ?? "Sem Cliente")</td>
                                <td>@entrega.DataAgendada.ToString("dd/MM/yyyy")</td>
                                <td>@(entrega.Orcamento.HasValue? entrega.Orcamento.Value.ToString("C") : "R$ 0,00")</td>
                            </tr>
                        }
                        <tr class="fw-bold bg-light">
                            <td colspan="3" class="text-end">Total:</td>
                            <td>@totalVendas.ToString("C")</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>
